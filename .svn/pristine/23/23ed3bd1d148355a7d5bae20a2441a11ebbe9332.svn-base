/**
 * XLe1丶
 * 2017年10月19日 2017年8月1日16:02:52
 */
package com.yidu.action.ErpStaff;

import java.lang.reflect.InvocationTargetException;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;

import org.apache.commons.beanutils.BeanUtils;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.yidu.model.ErpDepa;
import com.yidu.model.ErpModel;
import com.yidu.model.ErpModelSubordinate;
import com.yidu.model.ErpStaff;
import com.yidu.service.ErpDepa.ErpDepaService;
import com.yidu.service.ErpModel.ErpModelService;
import com.yidu.service.ErpModelSubordinate.ErpModelSubordinateService;
import com.yidu.service.ErpModelSubordinate.ErpModelSubordinateServiceImpl;
import com.yidu.service.ErpStaff.ErpStaffService;
import com.yidu.util.Pages;
import com.yidu.util.SsmMessage;

/**
 * @author XLe1丶
 * 2017年10月19日
 */
@Controller
@RequestMapping("staff")
public class ErpStaffAction {
	
	
	@Resource
	private ErpStaffService staffService;
	
	@Resource
	private ErpModelService modelService;
	
	@Resource
	private ErpModelSubordinateService modelSubService;
	
	@Resource
	private ErpDepaService depaService;
	
	
	@RequestMapping("findAllModel")
	public ModelAndView findAllModel(ErpStaff staff,HttpServletRequest request){
		int rows = staffService.getUser(staff);
		if(rows>0){
			List<ErpModel>list = modelService.findAllModel(staff.getStaEmail());
			List<ErpModel>list2 = modelService.getModel();
			request.setAttribute("model", list);
			request.setAttribute("modelSub", list2);
			ModelAndView view = new ModelAndView("homePage");
			return view;
		}else{
			System.out.println("妹纸");
			ModelAndView view = new ModelAndView("login");
			return view;
		}
		
		
		
	}
	
	@ResponseBody
	@RequestMapping("findAll")
	public Map<String, Object>findAll(ErpStaff staff,int page ,int limit){
		Map<String, Object> map = new HashMap<String, Object>();
		System.out.println("搜索框中的值为："+staff.getDepaName());
		Pages pages = new Pages();
		pages.setCurPage(page);
		pages.setMaxResult(limit);
		staff.setPage(pages.getFirstRows());
		staff.setLimit(limit);
		List<ErpStaff>list = staffService.findAll(staff);
		map.put("count", staffService.findRowCount(staff));
		map.put("data", list);
		map.put("code",0);
		map.put("msg", "");
		return map;
		
	}
	
	@ResponseBody
	@RequestMapping("getStaff")
	public String getStaff() throws JsonProcessingException{
		ObjectMapper objectMapper = new ObjectMapper();
		List<ErpStaff>list = staffService.getStaff();
		String jsonString = objectMapper.writeValueAsString(list);
		System.out.println(jsonString);
		return jsonString;
		
	}
	
	
	@ResponseBody
	@RequestMapping("getDepa")
	public String getDepa() throws JsonProcessingException{
		ObjectMapper objectMapper = new ObjectMapper();
		List<ErpDepa>list = depaService.getDepa();
		String jsonString = objectMapper.writeValueAsString(list);
		System.out.println("部门的json是"+jsonString);
		return jsonString;
	}
	
	@RequestMapping("updateById")
	@ResponseBody
	public String updateById(String id){
		staffService.updateById(id);
		return null;
		
	}
	
	
	@RequestMapping("edit")
	public String edit(String data) throws JsonProcessingException, IllegalAccessException, InvocationTargetException{
		System.out.println("data:"+data);
		return null;
		
	}
}
