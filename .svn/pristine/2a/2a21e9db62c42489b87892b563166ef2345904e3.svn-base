<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%
	String path = request.getContextPath();
	String basePath = request.getScheme() + "://" + request.getServerName() + ":" + request.getServerPort()
			+ path + "/";
%>
<!DOCTYPE html>
<html>
<head>
<base href="<%=basePath%>">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="res/layui/css/layui.css" media="all">
<script src="res/layui/layui.js" charset="utf-8"></script>
<script src="res/js/echarts.js"></script>
<script src="res/js/jquery-2.1.3.min.js"></script>
<title>财务管理</title>
</head>
<body>
	<div class="layui-tab" lay-filter="test1">
		<ul class="layui-tab-title">
			<li class="layui-this" lay-id="111">财务支出收入统计</li>
			<li lay-id="222">财务收入详情</li>
			<li lay-id="333">财务支出详情</li>
			<li lay-id="444">审核</li>
		</ul>
		<div class="layui-tab-content">
			<!-- 财务支出收入统计图 -->
			<div class="layui-tab-item layui-show">
				<div class="layui-inline">
			      <label class="layui-form-label">选择年份</label>
			      <div class="layui-input-inline">
			        <input class="layui-input" id="test2" placeholder="yyyy" type="text">
			      </div>
			    </div>
			     <!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
			    <div id="main" style="width: 1000px;height:750px;"></div>
			</div>
			<!-- 财务收入详情 -->
			<div class="layui-tab-item">
				<div class="demoTable">
					搜索ID：
					<div class="layui-inline">
						<input class="layui-input" name="id" id="demoReload"
							autocomplete="off">
					</div>
					<button class="layui-btn" data-type="reload">搜索</button>
				</div>

				<table class="layui-hide" id="LAY_table_user" lay-filter="user"></table>
			</div>
			<!-- 财务支出详情 -->
			<div class="layui-tab-item">3</div>
			<!-- 审核 -->
			<div class="layui-tab-item">4</div>
		</div>
	</div>

</body>
<script>
	var laydate;
	var element;
	var table;
	layui.use([ 'laydate', 'element', 'table' ], function() {
		laydate = layui.laydate;
		element = layui.element;
		table = layui.table;

		//获取hash来切换选项卡，假设当前地址的hash为lay-id对应的值
		var layid = location.hash.replace(/^#test1=/, '');
		element.tabChange('test1', layid); //假设当前地址为：http://a.com#test1=222，那么选项卡会自动切换到“发送消息”这一项

		//监听Tab切换，以改变地址hash值
		element.on('tab(test1)', function() {
			location.hash = 'test1=' + this.getAttribute('lay-id');
		});

		//执行一个laydate实例
		laydate.render({
			elem : '#test2',
			type : 'year',
			value : new Date(),
			done : function(value, date, endDate) {
				console.log(value); //得到日期生成的值，如：2017-08-18
				console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
				console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。
				eCharts(value);
			}
		});
		loadIndex = layer.load();//出现加载层
		//方法级渲染
		table.render({
			elem : '#LAY_table_user',
			url : 'applyasset/showList.action',
			cols : [ [ {
				checkbox : true,
				fixed : true
			}, {
				field : 'id',
				title : 'ID',
				width : 80,
				sort : true,
				fixed : true
			}, {
				field : 'username',
				title : '用户名',
				width : 80
			}, {
				field : 'sex',
				title : '性别',
				width : 80,
				sort : true
			}, {
				field : 'city',
				title : '城市',
				width : 80
			}, {
				field : 'sign',
				title : '签名',
				width : 177
			}, {
				field : 'experience',
				title : '积分',
				sort : true,
				width : 80
			}, {
				field : 'score',
				title : '评分',
				sort : true,
				width : 80
			}, {
				field : 'classify',
				title : '职业',
				width : 80
			}, {
				field : 'wealth',
				title : '财富',
				sort : true,
				width : 135
			} ] ],
			id : 'testReload',
			page : true,
			height : 413,
			done: function(res, curr, count){
		    	layer.close(loadIndex);//加载层关闭  
		    }
		});

		var $ = layui.$, active = {
			reload : function() {
				var demoReload = $('#demoReload');

				table.reload('testReload', {
					where : {
						key : {
							id : demoReload.val()
						}
					}
				});
			}
		};

		$('.demoTable .layui-btn').on('click', function() {
			var type = $(this).data('type');
			active[type] ? active[type].call(this) : '';
		});

	});

	$(function() {
		eCharts(new Date().getFullYear());
	})

	function eCharts(date) {
		$.post("finance/showList.action", {
			'date' : date
		}, function(returnData) {

			var zhichu = [];//支出金额
			var shouru = [];//收入金额 
			$.each(returnData.applyAssetList, function(i, item) {
				zhichu.push(item.appassNum);
			})
			$.each(returnData.payList, function(i, item) {
				shouru.push(item.payNum);
			})
			// 基于准备好的dom，初始化echarts实例
			var myChart = echarts.init(document.getElementById('main'));
			option = {
				title : {
					text : '收入支出统计'
				},
				tooltip : {
					trigger : 'axis',
					axisPointer : { // 坐标轴指示器，坐标轴触发有效
						type : 'shadow' // 默认为直线，可选为：'line' | 'shadow'
					}
				},
				legend : {
					data : [ '支出', '收入' ]
				},
				grid : {
					left : '3%',
					right : '4%',
					bottom : '3%',
					containLabel : true
				},
				xAxis : {
					type : 'category',
					boundaryGap : false,
					data : [ '一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月',
							'九月', '十月', '十一月', '十二月' ]
				},
				yAxis : {
					type : 'value'
				},
				series : [ {
					name : '支出',
					type : 'bar',
					data : zhichu
				}, {
					name : '收入',
					type : 'bar',
					data : shouru
				} ]
			};
			// 使用刚指定的配置项和数据显示图表。
			myChart.setOption(option);
		})
	}
</script>
</html>